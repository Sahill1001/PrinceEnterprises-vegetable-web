{% extends 'shop/basic.html' %}
{% block title %} {{product.product_name}} {% endblock %}
{% block css %} {% endblock %}
{% load static %}

{% block body %}
<div class="hero-wrap hero-bread" style="background-image: url({% static 'shop/images/bg_1.jpg' %});">
	<div class="container">
		<div class="row no-gutters slider-text align-items-center justify-content-center">
			<div class="col-md-9 ftco-animate text-center">
				<p class="breadcrumbs"><span class="mr-2"><a href="/">Home</a></span> <span class="mr-2"><a
							href="/shop/">Product</a></span> <span>{{product.product_name}}</span></p>
				<h1 class="mb-0 bread">{{product.product_name}}</h1>
			</div>
		</div>
	</div>
</div>

<section class="ftco-section">
	<div class="container">
		<div class="row">
			<div class="col-lg-6 mb-5 ftco-animate">
				<a href="/{{product.image}}" class="image-popup"><img src="/{{product.image}}"
						class="img-fluid" alt="Colorlib Template" id='imgpr{{product.id}}'></a>
			</div>
			<div class="col-lg-6 product-details pl-md-5 ftco-animate">
				<h3 id="namepr{{product.id}}">{{product.product_name}}</h3>
				<div class="rating d-flex">
					<p class="text-left mr-4">
						<a href="#" class="mr-2">5.0</a>
						<a href="#"><span class="ion-ios-star-outline"></span></a>
						<a href="#"><span class="ion-ios-star-outline"></span></a>
						<a href="#"><span class="ion-ios-star-outline"></span></a>
						<a href="#"><span class="ion-ios-star-outline"></span></a>
						<a href="#"><span class="ion-ios-star-outline"></span></a>
					</p>
					<p class="text-left mr-4">
						<a href="#" class="mr-2" style="color: #000;">100 <span style="color: #bbb;">Rating</span></a>
					</p>
					<p class="text-left">
						<a href="#" class="mr-2" style="color: #000;">500 <span style="color: #bbb;">Sold</span></a>
					</p>
				</div>
				<p class="price"><span id="salepr{{product.id}}">₹{{product.price}}</span>/
					<span id="unitpr{{product.id}}" style="font-size: 15px;">{{product.unit}}</span>
				</p>
				
				<p>A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a
					paradisematic country, in which roasted parts of sentences fly into your mouth. Text should turn
					around and return to its own, safe country. But nothing the copy said could convince her and so it
					didn’t take long until.
				</p>
				<div class="row mt-4">
					<div class="col-md-6">
						<div class="form-group d-flex">
							<div class="select-wrap">
								<div class="icon"><span class="ion-ios-arrow-down"></span></div>
								<select name="size" id="size" class="form-control">
									<option value="">Small</option>
									<option value="">Medium</option>
									<option value="">Large</option>
									<option value="">Extra Large</option>
								</select>
							</div>
						</div>
					</div>
					<div class="w-100"></div>
					<div class="input-group col-md-6 d-flex mb-3">
						<span class="input-group-btn mr-2">
							<button type="button" class="quantity-left-minus btn" data-type="minus" data-field="">
								<i class="ion-ios-remove"></i>
							</button>
						</span>
						<input type="text" id="quantity" name="quantity" class="form-control input-number" value="1"
							min="1" max="100">
						<span class="input-group-btn ml-2">
							<button type="button" class="quantity-right-plus btn" data-type="plus" data-field="">
								<i class="ion-ios-add"></i>
							</button>
						</span>
					</div>
					<div class="w-100"></div>
					<div class="col-md-12">
						<p style="color: #000;">10 kg available</p>
					</div>
				</div>
				<p><a class="btn btn-black py-3 px-5 sCart" id="pr{{product.id}}">Add to Cart</a></p>
			</div>
		</div>
	</div>
</section>

<section class="ftco-section">
	<div class="container">
		<div class="row justify-content-center mb-3 pb-3">
			<div class="col-md-12 heading-section text-center ftco-animate">
				<span class="subheading">Products</span>
				<h2 class="mb-4">Related Products</h2>
				<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia</p>
			</div>
		</div>
	</div>
	<div class="container">
		<div class="row">
			{% for rProduct in related %}
			<div class="col-md-6 col-lg-3 ftco-animate">
				<div class="product">
					<a class="img-prod"><img class="img-fluid" id='imgpr{{rProduct.id}}'
							src='/{{rProduct.image}}' alt="{{rProduct.product_name}}">
						<span class="status" id="offerpr{{rProduct.id}}">{{rProduct.offer}}%</span>
						<div class="overlay"></div>
					</a>
					<div class="text py-3 pb-4 px-3 text-center">
						<h3><a id="namepr{{rProduct.id}}">{{rProduct.product_name}}</a>
						</h3>
						<div class="d-flex">
							<div class="pricing">
								<p class="price">₹<span class="mr-2 price-dc"
										id="pricepr{{rProduct.id}}">{{rProduct.price}}</span>₹<span class=" price-sale"
										id="salepr{{rProduct.id}}">{{rProduct.price}}</span>/<span
										id="unitpr{{rProduct.id}}">{{rProduct.unit}}
										</span>
								</p>
							</div>
						</div>
						<div class="bottom-area d-flex px-3">
							<div class="m-auto d-flex divpr" id="divpr{{rProduct.id}}">
								<a href="/product/{{rProduct.id}}"
									class="add-to-cart d-flex justify-content-center align-items-center text-center">
									<span class="prod"><i class="ion-ios-menu"></i></span>
								</a>
								<a class="buy-now d-flex justify-content-center align-items-center mx-1 ">
									<span id="pr{{rProduct.id}}" class="cart"><i class="ion-ios-cart"></i></span>
								</a>
								<a class="heart d-flex justify-content-center align-items-center">
									<span id="wishlistpr{{rProduct.id}}" class="wishlist"><i
											class="ion-ios-heart"></i></span>
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
			{% endfor %}
		</div>
	</div>
</section>
{% endblock %}

{% block js %}
<script>
	$(document).ready(function () {

		var quantitiy = 0;
		$('.quantity-right-plus').click(function (e) {

			// Stop acting like a button
			e.preventDefault();
			// Get the field name
			var quantity = parseInt($('#quantity').val());

			// If is not undefined

			$('#quantity').val(quantity + 1);


			// Increment

		});

		$('.quantity-left-minus').click(function (e) {
			// Stop acting like a button
			e.preventDefault();
			// Get the field name
			var quantity = parseInt($('#quantity').val());

			// If is not undefined

			// Increment
			if (quantity > 0) {
				$('#quantity').val(quantity - 1);
			}
		});

	});


	//Related items
	// Find out the cart items from localStorage
	if (localStorage.getItem('cart') === null) {
		var cart = {};
	}
	else {
		cart = JSON.parse(localStorage.getItem('cart'));
		updateCart(cart);
	}

	// Find out wishlist items from localStoarge
	if (localStorage.getItem('wishlist') === null) {
		var wishlist = {};
	}
	else {
		wishlist = JSON.parse(localStorage.getItem('wishlist'));
		localStorage.setItem('wishlist', JSON.stringify(wishlist));
	}

	// If the add to cart button is clicked, add/increment the item
	$(".divpr").on("click", "span.cart", function (e) {
		e.preventDefault();
		let idstr = this.id.toString();
		if (cart[idstr] != undefined) {
			cart[idstr][0] += 1;
		} else {
			Qty = 1;
			name = document.getElementById('name' + idstr).innerHTML;
			price = parseInt(document.getElementById('sale' + idstr).innerHTML);
			img=document.getElementById('img'+idstr).src.slice(21);
			cart[idstr] = [Qty, name, price,img];
		}
		updateCart(cart);
	});

	$(".sCart").click(function (e) {
		e.preventDefault();
		let idstr = this.id.toString();
		Qty=parseInt($('#quantity').val())
		name = document.getElementById('name' + idstr).innerHTML;
		price =document.getElementById('sale' + idstr).innerHTML.slice(1,);
		img=document.getElementById('img'+idstr).src.slice(21);
		cart[idstr] = [Qty, name,parseInt(price),img];
		updateCart(cart);
	});

	// If the add to cart button is clicked, add/increment the item
	$(".divpr").on("click", "span.wishlist", function (e) {
		e.preventDefault();
		let idstr = this.id.slice(8,)
		if (wishlist[idstr] === undefined) {
			Qty = 1;
			name = document.getElementById('name' + idstr).innerHTML;
			price = parseInt(document.getElementById('sale' + idstr).innerHTML);
			wishlist[idstr] = [Qty, name, price];
			document.getElementById("wishlist"+idstr).style = "color:red;"
		} else {
			delete wishlist[idstr];
			document.getElementById('wishlist' + idstr).style = "white;"

		}
	});


	function updateCart(cart) {
		//var sum=0;
		for (let item in cart) {
			//sum=sum+cart[item];
			unit = document.getElementById("unit" + item).innerText;
			unitQ = document.getElementById("unit" + item).innerText.slice(0, 3);
			if (unit == "kg") {
				document.getElementById('div' + item).innerHTML = "<b><button id='minus" + item + "' class='btn btn-primary minus'>-</button> <span id='val" + item + "'' class='spn'>" + cart[item][0] + 'kg' + "</span> <button id='plus" + item + "' class='btn btn-primary plus'> + </button><b>";
			}
			else if (unit == "pc") {
				document.getElementById('div' + item).innerHTML = "<b><button id='minus" + item + "' class='btn btn-primary minus'>-</button> <span id='val" + item + "'' class='spn'>" + cart[item][0] + "</span> <button id='plus" + item + "' class='btn btn-primary plus'> + </button><b>";
			}
			else {
				if (cart[item][0] * unitQ > 999) {
					document.getElementById('div' + item).innerHTML = "<b><button id='minus" + item + "' class='btn btn-primary minus'>-</button> <span id='val" + item + "'' class='spn'>" + (cart[item][0] * unitQ) / 1000 + 'kg' + "</span> <button id='plus" + item + "' class='btn btn-primary plus'> + </button></b>";
				}
				else {
					document.getElementById('div' + item).innerHTML = "<b><button id='minus" + item + "' class='btn btn-primary minus'>-</button> <span id='val" + item + "'' class='spn'>" + cart[item][0] * unitQ + 'g' + "</span> <button id='plus" + item + "' class='btn btn-primary plus'> + </button></b>";
				}
			}
		}
		localStorage.setItem('cart', JSON.stringify(cart));
		//document.getElementById('cart').innerHTML =sum;
		document.getElementById('cart').innerHTML = Object.keys(cart).length;
		console.log(cart);
	}

	// If plus or minus button is clicked, change the cart as well as the display value
	$('.divpr').on("click", "button.minus", function (e) {
		e.preventDefault();
		a = this.id.slice(5,);
		prodId = this.id.slice(7,);
		cart[a][0] -= 1;
		cart[a][0] = Math.max(0, cart[a][0]);
		if (cart[a][0] === 0) {
			document.getElementById('div' + a).innerHTML = `<a href="/product/${prodId}" class="add-to-cart d-flex justify-content-center align-items-center text-center">
											<span class="prod"><i class="ion-ios-menu"></i></span>
										</a>
										<a class="buy-now d-flex justify-content-center align-items-center mx-1 ">
											<span id="${a}" class="cart"><i class="ion-ios-cart"></i></span>
										</a>
										<a class="heart d-flex justify-content-center align-items-center">
											<span id="wishlist${a}" class="wishlist"><i
													class="ion-ios-heart"></i></span>
										</a>`
			delete cart[a];
		}
		updateCart(cart);
	});

	$('.divpr').on("click", "button.plus", function (e) {
		e.preventDefault();
		a = this.id.slice(4,);
		cart[a][0] += + 1;
		updateCart(cart);
	});
</script>
{% endblock %}